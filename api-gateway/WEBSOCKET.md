# WebSocket API для Chat-Service

Данная спецификация описывает, как осуществляется подключение к WebSocket через API Gateway и какие события обмениваются между клиентом и сервером.

- **185.22.64.60** – URL, на котором работает API Gateway.
- **`/chat/socket.io`** – Путь для подключения WebSocket, соответствующий маршруту на сервере.

---

## Комнаты

В сервисе чата используются следующие комнаты:

1. **Комнаты поездок** (`ride_{rideId}`) – отдельная комната для каждой поездки.
2. **Комнаты пользователей** (`user_{userId}`) – индивидуальная комната для каждого пользователя.
3. **Общая комната уведомлений** (`notifications`) – используется для отправки глобальных уведомлений.

Примеры имен комнат:
- Поездка с ID `12345`: `ride_12345`
- Пользователь с ID `67890`: `user_67890`

---

## Присоединение к Комнатам

### Присоединение к комнате поездки
- **Событие:** `join_ride`
- **Параметры:**
    - `rideId` (string) – идентификатор поездки.

**Пример вызова (на клиенте):**
```js
socket.emit('join_ride', '12345');
```

### Присоединение к комнате пользователя
- **Событие:** `join_user`
- **Параметры:**
    - `userId` (string) – идентификатор пользователя.

**Пример вызова:**
```js
socket.emit('join_user', '67890');
```

### Присоединение к комнате уведомлений
- **Событие:** `join_notifications`
- **Параметры:** отсутствуют

**Пример вызова:**
```js
socket.emit('join_notifications');
```

---

## События от Сервера к Клиенту

### `chat_history`
- **Описание:** Отправка истории сообщений в комнате.
- **Параметры:**
    - `messages` (array) – массив сообщений.

**Пример:**
```js
socket.on('chat_history', (messages) => {
    console.log('История сообщений:', messages);
});
```

### `new_message`
- **Описание:** Уведомление о новом сообщении в комнате.
- **Параметры:**
    - `message` (object) – данные нового сообщения.

**Пример:**
```js
socket.on('new_message', (message) => {
    console.log('Новое сообщение:', message);
});
```

### `notification`
- **Описание:** Отправка уведомления пользователю.
- **Параметры:**
    - `message` (string) – текст уведомления.

**Пример:**
```js
socket.on('notification', (message) => {
    console.log('Уведомление:', message);
});
```

---

## События от Клиента к Серверу

### `send_message`
- **Описание:** Отправка нового сообщения.
- **Параметры:**
    - `rideId` (string) – ID поездки.
    - `receiverId` (string) – ID получателя.
    - `text` (string) – текст сообщения.

**Пример:**
```js
socket.emit('send_message', {
    rideId: '12345',
    receiverId: '67890',
    text: 'Привет!'
});
```

### `leave_ride`
- **Описание:** Покидание комнаты поездки.
- **Параметры:**
    - `rideId` (string) – ID поездки.

**Пример:**
```js
socket.emit('leave_ride', '12345');
```

### `leave_user`
- **Описание:** Покидание комнаты пользователя.
- **Параметры:**
    - `userId` (string) – ID пользователя.

**Пример:**
```js
socket.emit('leave_user', '67890');
```

---

## Заключение

Эта спецификация описывает базовые возможности WebSocket API для Chat-Service, включая механизмы подключения, подписки на события и обмена сообщениями между клиентом и сервером.

